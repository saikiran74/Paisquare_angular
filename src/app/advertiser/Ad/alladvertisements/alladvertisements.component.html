<div class="flex justify-content-center w-full px-2 pt-4 pb-2">
  <form (ngSubmit)="onSearchSubmit()" class="w-full">
    <div
      class="flex align-items-center gap-2 px-4 py-2 search-bar-container"
      [ngClass]="{ 'focused': isFocused }"
    >
      <!-- Search Icon -->
      <i class="pi pi-search text-gray-400" style="font-size: 1.5rem;"></i>

      <!-- Input Field -->
      <input
        pInputText
        type="text"
        [(ngModel)]="query"
        name="query"
        (focus)="isFocused = true"
        (blur)="isFocused = false"
        placeholder="# Search ads by content, heading, or description..."
        class="flex-1 text-base font-normal text-gray-700 border-none outline-none bg-transparent placeholder:text-gray-500"
        style="min-width: 0; font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;"
      />

      <!-- Gradient Button -->
      <button
      type="submit"
      class="text-white font-semibold"
      style="
        padding: 15px 30px; /* Height (vertical) and Width (horizontal) */
        font-size: 1rem; /* You can use 1.125rem (18px) or 1.25rem (20px) for larger text */
        border-radius: 12px; /* Controls how rounded it looks */
        background: linear-gradient(to right, #3b82f6, #8b5cf6); /* Blue to purple gradient */
        border: none;
        font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
      "
    >
      Search
    </button>
    </div>
  </form>
</div>

  


<div class="mx-auto p-3" style="max-width: 1152px;">
  <div class="grid md:grid-cols-4 gap-4">
    <!-- Category -->
     <div class="w-full md:flex-1">
    <label class="block text-sm font-medium text-color-secondary mb-2">Category</label>
    <div class="input-wrapper" [class.focused]="isFocusedCategory">
      <i class="pi pi-search input-icon"></i>
      <input
        pInputText
        [(ngModel)]="categorySearch"
        placeholder="Search categories..."
        class="styled-input"
        (focus)="isFocusedCategory = true"
        (blur)="isFocusedCategory = false"
      />
    </div>
    <div *ngIf="categorySearch" class="flex flex-wrap gap-2 mt-2 max-h-20 overflow-y-auto">
      <button
  *ngFor="let cat of filteredCategories"
  pButton
  [label]="cat"
  size="small"
  [ngClass]="selectedCategory === cat ? 'btn-primary' : 'btn-secondary'"
  (click)="selectCategory(cat)"
></button>
    </div>
  </div>
    <!-- Location -->
     <div class="w-full md:flex-1">
    <label class="block text-sm font-medium text-color-secondary mb-2">Location</label>
    <div class="input-wrapper" [class.focused]="isFocusedLocation">
      <i class="pi pi-map-marker input-icon"></i>
      <input
        pInputText
        [(ngModel)]="location"
        placeholder="City, state"
        class="styled-input"
        (focus)="isFocusedLocation = true"
        (blur)="isFocusedLocation = false"
      />
    </div>
  </div>
    <!-- Pincode -->
     <div>
          <label class="block text-sm font-medium text-color-secondary mb-2">Pincodes</label>
          <div class="flex gap-2 mb-2">
            <input
              pInputText
              [(ngModel)]="newPincode"
              (input)="sanitizePincode()"
              placeholder="6-digit"
              maxlength="6"
              class="flex-1"
            />
            <button
              pButton
              label="Add"
              size="small"
              (click)="addPincode()"
              [disabled]="newPincode.length !== 6"
            ></button>
          </div>
          <p-chip
            *ngFor="let pin of pincodes"
            [label]="pin"
            class="mr-1 mb-1"
            [removable]="true"
            (remove)="removePincode(pin)"
          ></p-chip>
        </div>
    <!-- Hashtag (your current block) -->
     <div>
    <label class="block text-sm font-medium text-color-secondary mb-2">Hashtags</label>
    
    <!-- Wrap input in a relative container -->
    <div class="relative flex gap-2 mb-2">
  
      <!-- Hashtag icon -->
      <i class="pi pi-hashtag hashtag-icon"></i>
  
      <!-- Input Field -->  
      <input
        pInputText
        [(ngModel)]="newHashtag"
        (input)="sanitizeHashtag()"
        (keydown.enter)="addHashtag()"
        placeholder="hashtag"
        class="flex-1 hashtag-input"
        (focus)="isFocusedHashtag = true"
        (blur)="isFocusedHashtag = false"
      />
  
      <!-- Add Button -->
      <button
        pButton
        label="Add"
        size="small"
        severity="prima"
        (click)="addHashtag()"
        [disabled]="!newHashtag.trim()"
      ></button>
      
    </div>
  
    <!-- Display Added Tags -->
  </div>
<!-- Filter Action Buttons -->
<div
  class="flex flex-column md:flex-row justify-content-between align-items-center gap-3 mt-3 pt-2 border-top-1"
  style="border-color: #f2f3f6;"
>

  <!-- LEFT: Clear All Button -->
  <div class="w-full md:w-auto">
    <button
      (click)="clearAllFilters()"
      style="
        background-color: transparent;
        border: none;
        color: #515254;
        padding: 6px 12px;
        font-size: 0.875rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s ease, color 0.2s ease;
      "
      onmouseover="this.style.backgroundColor='#f3f4f6'; this.style.color='#374151'"
      onmouseout="this.style.backgroundColor='transparent'; this.style.color='#6b7280'"
      [disabled]="!hasActiveFilters"
    >
      Clear All
    </button>
  </div>

  <!-- Buttons Block -->
<div class="flex flex-column sm:flex-row gap-2 w-full md:w-auto justify-content-end">

  <!-- Reset -->
  <!-- Reset Button -->
<button
  pButton
  label="Reset"
  class="w-full sm:w-auto px-4"
  size="small"
  [disabled]="!hasActiveFilters"
  (click)="clearAllFilters()"
  style="
    background-color: white;
    color: #374151;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-weight: 500;
    transition: background-color 0.2s ease;
  "
></button>

<!-- Apply Filters Button -->
<button
  pButton
  label="Apply Filters"
  class="w-full sm:w-auto px-4 text-white apply-btn-blue"
  size="small"
  [ngStyle]="{
    backgroundColor: hasActiveFilters ? '#3b82f6' : '#d1d5db',
    border: 'none',
    cursor: hasActiveFilters ? 'pointer' : 'not-allowed',
    opacity: hasActiveFilters ? 1 : 0.6,
    borderRadius: '6px',
    fontWeight: '500'
  }"
  [disabled]="!hasActiveFilters"
  (click)="handleSubmitFilters()"
></button>


</div>
</div>


</div>
    </div>
<br><br> 















<div class="grid" style="background-color: rgba(239, 242, 245, 0.877); padding: 8px;">
    <div class="flex col-12">
        <div style="display: flex; flex-wrap: wrap;  " class="gap-2 justify-content-start align-items-center">
            <ng-container *ngFor="let chip of chips | slice:0:5; let i = index">
                <p-chip
                  *ngIf="chip.label && chip.label.trim().length > 0"
                  [label]="chip.label"
                  [styleClass]="activeChipIndex === i ? 'active-chip' : 'inactive-chip'"
                  (click)="onChipClick(i)">
                </p-chip>
            </ng-container>
        </div>
        <div class="flex justify-content-end align-items-center" style="flex-grow: 1; text-align: right;">
            @if(!isMobileView){
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <!--<input style="height: 35px;"
                        pInputText style="padding-left: 30px;"
                        placeholder="Filter by pincodes"
                        (keydown.enter)="onSearch($event)" 
                    />-->
                    <p-inputMask mask="999999" class="form-control"
                     [style]="{'height': '35px','padding-left':'30px'}"
                    formControlName="pincode" placeholder="Filter by pincodes" (keydown.enter)="onSearch($event)" /><br>
                </span>
            } @else {
                <span class="search-icon" *ngIf="isMobileView">
                    <i class="pi pi-search" style="font-size: 1.5rem;" (click)="toggleSearchBox()"></i>
                </span>
            }
        </div>
    </div>
        @if (showSearchBox) {
            <div class="grid">
                <div class="col-12">
                    <span class="search-box">
                        <input 
                            pInputText style="margin-left: 18px;"
                            placeholder="Filter by pincodes"
                            (keydown.enter)="onSearch($event)" 
                        />
                    </span>
                </div>
            </div>
        }
</div>

<div class="container" >
    @if (querySearch) {
        @if (advertisements.length > 0) {
            <app-homepage
            *ngFor="let ad of advertisements"
            [ad]="ad"
        ></app-homepage>
        } @else {
            <p>No advertisements found for your query.</p>
        }

    } @else {
        <app-homepage *ngFor="let ads of advertisements" [ad]="ads" (fetchData)="fetchadvertisement()"></app-homepage>
    }
</div>
